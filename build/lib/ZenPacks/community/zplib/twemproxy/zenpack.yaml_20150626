name: ZenPacks.community.zplib.twemproxy

zProperties:
  DEFAULT:
    category: twemproxy
 
  zTwemproxyPort:
    type: string
    default: 22222

device_classes:
  /Server/Linux/twemproxy:
    remove: True

    zProperties:
      zPythonClass: ZenPacks.community.zplib.twemproxy.TwemproxyDevice
 
    templates:
      TwemproxyServerPool:    # template name should be same as LABEL of component with spaces removed!!!
        description: Monitor various metrics for server pool component
        targetPythonClass: ZenPacks.community.zplib.twemproxy.TwemproxyServerPool

        datasources:
          ClientEof:
            type: Python
            plugin_classname: ZenPacks.community.zplib.twemproxy.dsplugins.zplibTwemproxyDeviceData
            cycletime: 60
            component: ${here/id}
            eventClass: /Twemproxy

            datapoints:
              client_eof:
                rrdtype: DERIVE
                rrdmin: 0

        graphs:
          twemproxy Client EOF:
            units: EOFs / sec

            graphpoints:
              twemproxy Client EOF:
                dpName: ClientEof_client_eof
                format: "%7.2lf"

      TwemproxyServer:     # Name of template should be same as LABEL of component - with spaces removed!!!
        description: Monitor various metrics for server component
        targetPythonClass: ZenPacks.community.zplib.twemproxy.TwemproxyServer

        datasources:
          ServerEof:
            type: Python
            plugin_classname: ZenPacks.community.zplib.twemproxy.dsplugins.zplibTwemproxyDeviceData
            cycletime: 60
            component: ${here/id}
            eventClass: /Twemproxy

            datapoints:
              server_eof:
                rrdtype: DERIVE
                rrdmin: 0

          OutQueue:
            type: Python
            plugin_classname: ZenPacks.community.zplib.twemproxy.dsplugins.zplibTwemproxyDeviceData
            cycletime: 60
            component: ${here/id}
            eventClass: /Twemproxy

            datapoints:
              out_queue:
                rrdtype: GAUGE

          ServerTimedout:
            type: Python
            plugin_classname: ZenPacks.community.zplib.twemproxy.dsplugins.zplibTwemproxyDeviceData
            cycletime: 60
            component: ${here/id}
            eventClass: /Twemproxy

            datapoints:
              server_timedout:
                rrdtype: GAUGE

          Requests:
            type: Python
            plugin_classname: ZenPacks.community.zplib.twemproxy.dsplugins.zplibTwemproxyDeviceData
            cycletime: 60
            component: ${here/id}
            eventClass: /Twemproxy

            datapoints:
              requests:
                rrdtype: DERIVE
                rrdmin: 0


        graphs:
          twemproxy Server EOF:
            units: EOFs  / sec

            graphpoints:
              twemproxy Server EOF:
                dpName: ServerEof_server_eof
                format: "%7.2lf"

          twemproxy Server Out Queue:
            units: Out Queue

            graphpoints:
              twemproxy Server Out Queue:
                dpName: OutQueue_out_queue
                format: "%7.2lf"

          twemproxy Server Timedout:
            units: timeouts

            graphpoints:
              twemproxy Server Timedout:
                dpName: ServerTimedout_server_timedout
                format: "%7.2lf"

          twemproxy Server Requests:
            units: Requests / sec

            graphpoints:
              twemproxy Server Requests:
                dpName: Requests_requests
                format: "%7.2lf"


classes:
  DEFAULTS:
    base: [zenpacklib.Component]

  TwemproxyDevice:
    base: [zenpacklib.Device]
    label: Twemproxy Server

    properties:
      twemproxy_version:
        type: string
        label: twemproxy Version

      twemproxy_uptime:
        type: int
        label: twemproxy Uptime (days)
        short_label: Uptime

      twemproxy_curr_connections:
        type: int
        label: twemproxy Current Connections
        short_label: Curr. Conns.

  TwemproxyServerPool:
      label: Twemproxy Server Pool
      order: 60 # Display before Server

  TwemproxyServer:
      label: Twemproxy Server
      order: 70 # Display after Server Pool

      properties:
        serverName:
          type: string
          label: Server Name
          short_label: Name
          label_width: 200

        serverAddress:
          type: string
          label: Server Address
          short_label: Address

        serverPort:
          type: string
          label: Server Port
          short_label: Port
          label_width: 60

class_relationships:
  - TwemproxyDevice 1:MC TwemproxyServerPool
  - TwemproxyServerPool 1:MC TwemproxyServer


